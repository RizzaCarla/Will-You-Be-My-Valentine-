<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Special Delivery üíå</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700&display=swap" rel="stylesheet">

<style>
  :root{
    --pink1:#ffd6e7;
    --pink2:#ffc2d1;
    --accent:#ff4d6d;
    --ink:#ffffff;
    --inkDark:#e9e9e9;

    --envelopeW:340px;
    --envelopeH:230px;

    --cardMax:560px;
    --cardMinH:230px;
  }

  *{ box-sizing:border-box; }

  body{
    margin:0;
    font-family:'Quicksand', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background:linear-gradient(135deg,var(--pink1),var(--pink2));
    height:100vh;
    overflow:hidden;
    display:flex;
    justify-content:center;
    align-items:center;
    user-select:none;
  }

  /* MAILBOX */
  .mailbox{
    width:200px;height:160px;
    background:var(--accent);
    border-radius:20px;
    position:relative;
    cursor:pointer;
    box-shadow:0 18px 35px rgba(0,0,0,.18);
  }
  .flag{
    width:10px;height:60px;background:white;
    position:absolute;right:-15px;top:20px;border-radius:6px;
  }
  .mail-slot{
    width:120px;height:20px;background:#333;
    position:absolute;top:70px;left:40px;border-radius:10px;opacity:.9;
  }

  /* ENVELOPE */
  .envelope{
    display:none;
    width:var(--envelopeW);
    height:var(--envelopeH);
    background:white;
    border-radius:12px;
    position:relative;
    transform-style:preserve-3d;
    transition:transform 1s;
    cursor:pointer;
    box-shadow:0 18px 40px rgba(0,0,0,.18);
  }
  .envelope.flip{ transform:rotateY(180deg); }

  .face{
    position:absolute;
    inset:0;
    backface-visibility:hidden;
    border-radius:12px;
    overflow:hidden;
  }

  /* BACK SIDE */
  .back{ background:#fff; }

  /* FRONT SIDE */
  .front{
    transform:rotateY(180deg);
    background:#fff;
  }

  .tofrom{
    position:absolute;
    top:16px;
    left:16px;
    font-size:18px;
    line-height:1.25;
    font-weight:700;
    color:#1f1f1f;
  }

  /* Top-right stamp block */
  .stamp-area{
    position:absolute;
    top:12px;
    right:12px;
    width:118px;
    height:148px;
  }

  /* Forever stamp (inspired by your photo) */
  .forever-stamp{
    position:absolute;
    top:0;
    right:0;
    width:110px;
    height:140px;
    transform:rotate(-12deg);
    filter:drop-shadow(0 10px 16px rgba(0,0,0,.18));
  }

  /* Delivery stamp overlaps forever stamp */
  .delivery-stamp{
    position:absolute;
    top:66px;      /* overlap */
    right:8px;
    width:120px;
    transform:rotate(-10deg);
    filter:drop-shadow(0 8px 14px rgba(0,0,0,.14));
    pointer-events:none;
  }

  /* Flap */
  .flap{
    position:absolute;
    left:0; right:0;
    top:0;
    margin:auto;
    width:0;height:0;
    border-left:170px solid transparent;
    border-right:170px solid transparent;
    border-top:120px solid var(--accent);
    transform-origin:top;
    cursor:pointer;
  }
  .front::after{
    content:"";
    position:absolute;
    inset:0;
    border-radius:12px;
    border:2px solid rgba(0,0,0,.06);
    pointer-events:none;
  }

  /* OVERLAYS (spaces around card so background shows) */
  .overlay{
    position:fixed;
    inset:0;
    display:none;
    place-items:center;
    padding:22px;               /* visible background border */
    background:rgba(0,0,0,.16); /* soft dim */
  }

  .card{
    width:min(92vw, var(--cardMax));
    max-height:82vh;
    overflow:auto;
    background:white;
    border-radius:18px;
    box-shadow:0 22px 55px rgba(0,0,0,.24);
    padding:16px 16px 22px;
    position:relative;
    min-height:var(--cardMinH);
  }

  .card-header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    padding-bottom:8px;
    border-bottom:1px solid rgba(0,0,0,.08);
    margin-bottom:12px;
  }

  .card-title{
    font-weight:800;
    font-size:18px;
  }

  .close{
    width:42px;height:42px;
    border-radius:14px;
    border:none;
    cursor:pointer;
    font-size:20px;
    background:rgba(0,0,0,.06);
    transition:transform .15s ease, background .15s ease;
  }
  .close:hover{ background:rgba(0,0,0,.10); transform:translateY(-1px); }
  .close:active{ transform:scale(.98); }

  /* Images: fit inside letter/card */
  .photo{
    width:100%;
    height:clamp(140px, 28vh, 240px);
    object-fit:cover;
    border-radius:14px;
    margin:10px 0 14px;
  }

  /* typing line */
  .type{
    font-size:22px;
    font-weight:800;
    border-right:3px solid rgba(255,77,109,.55);
    overflow:hidden;
    white-space:nowrap;
    width:0;
    animation:typing 2.2s steps(34,end) forwards;
  }
  @keyframes typing{ to{ width:100%; } }

  .btn-row{
    margin-top:18px;
    display:flex;
    gap:12px;
    flex-wrap:wrap;
    align-items:center;
    position:relative;
    min-height:64px;
  }

  /* Rounded pill, non-cursive font */
  .pill{
    font-family:'Quicksand', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    font-size:18px;
    font-weight:800;
    padding:12px 22px;
    border:none;
    border-radius:999px;
    cursor:pointer;
    letter-spacing:.3px;
    text-transform:lowercase; /* yes / no */
    transition:transform .15s ease, filter .15s ease, box-shadow .15s ease;
    box-shadow:0 12px 24px rgba(0,0,0,.12);
  }
  .pill:hover{
    transform:translateY(-2px);
    filter:brightness(1.02);
    box-shadow:0 16px 30px rgba(0,0,0,.16);
  }
  .pill:active{ transform:translateY(0px) scale(.98); }

  .yes{ background:var(--accent); color:#fff; }
  .no{
    background:#2f2f2f;
    color:#fff;
    position:relative; /* becomes absolute once it starts moving */
  }

  .response-text{
    font-size:18px;
    line-height:1.5;
    font-weight:700;
  }

  /* HEARTS */
  .heart{
    position:fixed;
    bottom:-20px;
    font-size:26px;
    animation:float 7.5s linear;
    pointer-events:none;
  }
  @keyframes float{
    to{ transform:translateY(-110vh); opacity:0;}
  }
</style>
</head>

<body>

<!-- Romantic public/free music (Pixabay CDN) -->
<audio id="music" preload="auto" loop>
  <!-- You can swap this for another Pixabay CDN MP3 anytime -->
  <source src="https://cdn.pixabay.com/download/audio/2022/05/23/audio_4f9d6a0c5d.mp3?filename=romantic-piano-112191.mp3" type="audio/mpeg">
</audio>

<div class="mailbox" id="mailbox" aria-label="Mailbox">
  <div class="flag"></div>
  <div class="mail-slot"></div>
</div>

<div class="envelope" id="envelope" aria-label="Envelope">

  <!-- BACK -->
  <div class="face back">
    <div class="tofrom">
      To Aaron<br>
      From Rizza
    </div>

    <div class="stamp-area">

      <!-- Forever stamp (SVG so it never ‚Äúbreaks‚Äù) -->
      <svg class="forever-stamp" viewBox="0 0 220 280" xmlns="http://www.w3.org/2000/svg" aria-label="Forever stamp">
        <!-- perforated edge -->
        <defs>
          <filter id="soft" x="-20%" y="-20%" width="140%" height="140%">
            <feDropShadow dx="0" dy="0" stdDeviation="2" flood-color="rgba(0,0,0,.15)"/>
          </filter>
        </defs>

        <rect x="12" y="12" width="196" height="256" rx="10" fill="#b0192b" filter="url(#soft)"/>
        <!-- faux perforation border -->
        <rect x="16" y="16" width="188" height="248" rx="8" fill="none" stroke="#ffffff" stroke-opacity=".55" stroke-width="6" stroke-dasharray="2 12" />

        <!-- 'us forever' -->
        <text x="28" y="55" fill="#ffffff" font-size="24" font-weight="700" font-family="Quicksand, Arial, sans-serif">
          us forever
        </text>

        <!-- simple dove + envelope icon inspired by your stamp -->
        <g transform="translate(28,78)">
          <!-- envelope -->
          <rect x="92" y="10" width="72" height="52" rx="8" fill="#ffb6c7"/>
          <path d="M92 16 L128 42 L164 16" fill="none" stroke="#fff" stroke-width="4" stroke-linecap="round" />
          <circle cx="150" cy="42" r="9" fill="#ff3b5c"/>
          <!-- dove body -->
          <path d="M6 88 C24 62, 54 52, 82 56 C112 60, 124 74, 130 98
                   C132 108, 128 120, 118 130 C92 158, 52 160, 24 140
                   C10 130, 2 112, 6 88 Z"
                fill="#ffffff" opacity=".95"/>
          <!-- wings -->
          <path d="M46 72 L100 44 L110 58 L60 86 Z" fill="#ffffff"/>
          <path d="M52 108 L110 86 L114 100 L64 130 Z" fill="#ffffff" opacity=".95"/>
          <!-- beak -->
          <path d="M130 92 L150 86 L146 98 Z" fill="#ffd1dc"/>
          <!-- tiny heart -->
          <path d="M98 132
                   C98 124, 110 124, 110 132
                   C110 140, 104 144, 104 144
                   C104 144, 98 140, 98 132 Z"
                fill="#ff3b5c"/>
        </g>

        <!-- bottom tiny text -->
        <text x="160" y="250" fill="#ffffff" font-size="20" font-weight="700" font-family="Quicksand, Arial, sans-serif">
          forever
        </text>
      </svg>

      <!-- Special Delivery stamp (overlapping + includes location + today) -->
      <svg class="delivery-stamp" viewBox="0 0 520 300" xmlns="http://www.w3.org/2000/svg" aria-label="Special delivery stamp">
        <defs>
          <!-- dotted border effect -->
          <pattern id="dots" width="14" height="14" patternUnits="userSpaceOnUse">
            <circle cx="7" cy="7" r="2.1" fill="#ffffff" opacity=".95"/>
          </pattern>
          <filter id="distress" x="-20%" y="-20%" width="140%" height="140%">
            <feTurbulence type="fractalNoise" baseFrequency=".9" numOctaves="2" seed="3" />
            <feColorMatrix type="matrix" values="
              1 0 0 0 0
              0 1 0 0 0
              0 0 1 0 0
              0 0 0 .15 0" result="noise"/>
            <feComposite in="SourceGraphic" in2="noise" operator="arithmetic" k1="1" k2="0" k3="0" k4="0"/>
          </filter>
        </defs>

        <!-- outer -->
        <rect x="12" y="12" width="496" height="276" rx="16" fill="none" stroke="#ffffff" stroke-width="10" opacity=".95" />
        <!-- dotted inner -->
        <rect x="26" y="26" width="468" height="248" rx="12" fill="none" stroke="url(#dots)" stroke-width="10" opacity=".95" />

        <!-- stars -->
        <g fill="#ffffff" opacity=".95" transform="translate(0,0)">
          <path d="M260 56 l10 20 22 3-16 15 4 22-20-11-20 11 4-22-16-15 22-3z"/>
          <path d="M210 70 l6 12 14 2-10 9 2 14-12-6-12 6 2-14-10-9 14-2z"/>
          <path d="M310 70 l6 12 14 2-10 9 2 14-12-6-12 6 2-14-10-9 14-2z"/>
        </g>

        <!-- SPECIAL DELIVERY -->
        <text x="260" y="112"
              text-anchor="middle"
              fill="#ffffff"
              font-size="54"
              font-weight="800"
              font-family="Quicksand, Arial, sans-serif"
              letter-spacing="2"
              filter="url(#distress)">
          SPECIAL DELIVERY
        </text>

        <!-- wavy lines -->
        <g stroke="#ffffff" stroke-width="6" opacity=".92" fill="none" transform="translate(0,0)">
          <path d="M80 150 C130 130, 180 170, 230 150 S330 170, 380 150 S460 170, 500 150"/>
          <path d="M80 172 C130 152, 180 192, 230 172 S330 192, 380 172 S460 192, 500 172"/>
          <path d="M80 194 C130 174, 180 214, 230 194 S330 214, 380 194 S460 214, 500 194"/>
        </g>

        <!-- bottom strip -->
        <rect x="60" y="218" width="400" height="56" rx="12" fill="none" stroke="#ffffff" stroke-width="8" opacity=".95"/>
        <text x="260" y="255" text-anchor="middle"
              fill="#ffffff"
              font-size="26"
              font-weight="800"
              font-family="Quicksand, Arial, sans-serif"
              letter-spacing="1">
          CUPID POST OFFICE ‚Ä¢ <tspan id="deliveryDate"></tspan>
        </text>
      </svg>

    </div>
  </div>

  <!-- FRONT -->
  <div class="face front">
    <div class="flap" id="flap" title="Open"></div>
  </div>
</div>

<!-- FIRST LETTER -->
<div class="overlay" id="overlayLetter">
  <div class="card" id="letterCard" role="dialog" aria-modal="true">
    <div class="card-header">
      <div class="card-title">Special Note</div>
      <button class="close" id="closeLetterBtn" aria-label="Close">‚úï</button>
    </div>

    <img src="photo.jpeg" class="photo" alt="Photo 1">

    <div class="type">Will you be my Valentine?</div>

    <div class="btn-row" id="btnRow">
      <button class="pill yes" id="yesBtn">yes</button>
      <button class="pill no" id="noBtn">no</button>
    </div>
  </div>
</div>

<!-- RESPONSE LETTER -->
<div class="overlay" id="overlayResponse">
  <div class="card" id="responseCard" role="dialog" aria-modal="true">
    <div class="card-header">
      <div class="card-title">Message</div>
      <button class="close" id="closeResponseBtn" aria-label="Close">‚úï</button>
    </div>

    <img src="photo2.jpeg" class="photo" alt="Photo 2">

    <div class="response-text">
      I love you ‚ô•Ô∏è Thank you for being my valentine.<br><br>
      I cant wait for our hiking date this weekend.<br><br>
      PS. I wouldn‚Äôt have taken no for an answer.
    </div>
  </div>
</div>

<script>
  const mailbox = document.getElementById("mailbox");
  const envelope = document.getElementById("envelope");
  const flap = document.getElementById("flap");

  const overlayLetter = document.getElementById("overlayLetter");
  const letterCard = document.getElementById("letterCard");
  const closeLetterBtn = document.getElementById("closeLetterBtn");

  const overlayResponse = document.getElementById("overlayResponse");
  const responseCard = document.getElementById("responseCard");
  const closeResponseBtn = document.getElementById("closeResponseBtn");

  const yesBtn = document.getElementById("yesBtn");
  const noBtn = document.getElementById("noBtn");
  const btnRow = document.getElementById("btnRow");

  const music = document.getElementById("music");

  // NO: move 3 times, 4th flies away
  const NO_MOVE_LIMIT = 3;
  let noClicks = 0;

  // hearts interval
  let heartsInterval = null;

  /* DATE (for delivery stamp) */
  const today = new Date();
  const niceDate = today.toLocaleDateString(undefined, { year:"numeric", month:"long", day:"numeric" });
  document.getElementById("deliveryDate").textContent = niceDate;

  /* MUSIC UNLOCK: required by mobile browsers */
  let audioUnlocked = false;
  function unlockAudioOnce(){
    if (audioUnlocked) return;
    audioUnlocked = true;

    // quick silent play/pause to unlock
    music.volume = 0.001;
    music.muted = true;

    const p = music.play();
    if (p && typeof p.then === "function"){
      p.then(() => {
        music.pause();
        music.currentTime = 0;
        music.muted = false;
        music.volume = 0.35;
      }).catch(() => {
        // still usually works on YES click since it's a gesture
        music.muted = false;
        music.volume = 0.35;
      });
    } else {
      music.muted = false;
      music.volume = 0.35;
    }
  }
  window.addEventListener("pointerdown", unlockAudioOnce, { once:true });

  /* MAILBOX -> ENVELOPE */
  mailbox.addEventListener("click", () => {
    mailbox.style.display = "none";
    envelope.style.display = "block";
  });

  /* FLIP ENVELOPE (click envelope) */
  envelope.addEventListener("click", (e) => {
    if (e.target === flap) return;
    envelope.classList.toggle("flip");
  });

  /* OPEN FIRST LETTER */
  flap.addEventListener("click", (e) => {
    e.stopPropagation();
    openLetter();
  });

  function openLetter(){
    overlayLetter.style.display = "grid";
    resetNoButton();
  }

  function closeLetter(){
    overlayLetter.style.display = "none";
  }

  function openResponse(){
    overlayResponse.style.display = "grid";
  }

  function closeResponse(){
    overlayResponse.style.display = "none";
  }

  closeLetterBtn.addEventListener("click", closeLetter);
  closeResponseBtn.addEventListener("click", closeResponse);

  /* click outside closes */
  overlayLetter.addEventListener("click", closeLetter);
  letterCard.addEventListener("click", (e) => e.stopPropagation());

  overlayResponse.addEventListener("click", closeResponse);
  responseCard.addEventListener("click", (e) => e.stopPropagation());

  /* YES: hide first letter, open response + music + hearts */
  yesBtn.addEventListener("click", async () => {
    closeLetter();
    openResponse();

    try{
      music.currentTime = 0;
      music.volume = 0.35;
      await music.play();
    }catch(e){
      // If something blocks, user can tap once more; but the unlock handler should prevent this.
      console.warn("Music blocked:", e);
    }

    startHearts();
    navigator.vibrate?.(200);
  });

  /* NO: move 3 times, 4th flies away */
  noBtn.addEventListener("click", () => {
    noClicks++;

    if (noClicks <= NO_MOVE_LIMIT){
      const rowRect = btnRow.getBoundingClientRect();
      const btnRect = noBtn.getBoundingClientRect();

      const maxX = Math.max(0, rowRect.width - btnRect.width - 12);
      const maxY = Math.max(0, rowRect.height - btnRect.height - 12);

      const x = Math.random() * maxX;
      const y = Math.random() * maxY;

      noBtn.style.position = "absolute";
      noBtn.style.left = x + "px";
      noBtn.style.top  = y + "px";
    } else {
      noBtn.disabled = true;
      noBtn.style.transition = "transform .8s ease, opacity .8s ease";
      noBtn.style.transform = "translateY(-500px) rotate(-18deg)";
      noBtn.style.opacity = "0";
      setTimeout(() => noBtn.style.display = "none", 850);
    }
  });

  function resetNoButton(){
    noClicks = 0;
    noBtn.style.display = "inline-block";
    noBtn.disabled = false;
    noBtn.style.transition = "";
    noBtn.style.opacity = "1";
    noBtn.style.transform = "none";
    noBtn.style.position = "relative";
    noBtn.style.left = "0px";
    noBtn.style.top = "0px";
  }

  /* HEARTS */
  function startHearts(){
    if (heartsInterval) return;

    heartsInterval = setInterval(() => {
      const h = document.createElement("div");
      h.className = "heart";
      h.innerText = ["üíñ","üíó","üíû","üéÄ","‚ú®","üå∏"][Math.floor(Math.random()*6)];
      h.style.left = Math.random() * 100 + "vw";
      document.body.appendChild(h);
      setTimeout(() => h.remove(), 7500);
    }, 800);
  }
</script>

</body>
</html>