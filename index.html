<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Special Delivery üíå</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700&display=swap" rel="stylesheet">

<style>
  :root{
    --pink1:#ffd6e7;
    --pink2:#ffc2d1;
    --accent:#ff4d6d;
    --deliveryRed:#8f1023;

    --envelopeW:340px;
    --envelopeH:230px;

    --cardMax:560px;
    --cardMinH:230px;
  }

  *{ box-sizing:border-box; }

  body{
    margin:0;
    font-family:'Quicksand', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background:linear-gradient(135deg,var(--pink1),var(--pink2));
    height:100vh;
    overflow:hidden;
    display:flex;
    justify-content:center;
    align-items:center;
    user-select:none;
  }

  /* ---------- MAILBOX ---------- */
  .mailbox{
    width:200px;height:160px;
    background:var(--accent);
    border-radius:20px;
    position:relative;
    cursor:pointer;
    box-shadow:0 18px 35px rgba(0,0,0,.18);
    transition:transform .35s ease, opacity .35s ease;
    overflow:visible;
  }
  .mailbox.opening{
    transform:scale(.92) translateY(6px);
    opacity:0;
    pointer-events:none;
  }

  /* Right-side pole */
  .flag-pole{
    position:absolute;
    right:-18px;
    top:20px;
    width:10px;
    height:70px;
    background:#fff;
    border-radius:6px;
    box-shadow:0 10px 18px rgba(0,0,0,.14);
  }

  /* White triangle flag */
  .flag-triangle{
    position:absolute;
    right:-44px;
    top:28px;
    width:0;height:0;
    border-top:12px solid transparent;
    border-bottom:12px solid transparent;
    border-left:26px solid #fff;
    filter:drop-shadow(0 6px 10px rgba(0,0,0,.18));
  }

  .mail-slot{
    width:120px;height:20px;background:#333;
    position:absolute;top:70px;left:40px;border-radius:10px;opacity:.9;
  }

  /* ---------- ENVELOPE (BACK RESTORED + FLIP FIXED) ---------- */
  .envelope{
    display:none;
    width:var(--envelopeW);
    height:var(--envelopeH);
    background:#fff;
    border-radius:12px;
    position:relative;
    transform-style:preserve-3d;
    cursor:pointer;
    box-shadow:0 18px 40px rgba(0,0,0,.18);
    animation:popIn .45s ease both;
    transform:rotateY(0deg);
  }
  @keyframes popIn{
    from{ transform:scale(.9); opacity:0; }
    to{ transform:scale(1); opacity:1; }
  }

  .envelope.flip{
    transform:rotateY(180deg);
    transition:transform 950ms cubic-bezier(.2,.9,.2,1.1);
  }
  .envelope:not(.flip){
    transition:transform 950ms cubic-bezier(.2,.9,.2,1.1);
  }

  .face{
    position:absolute;
    inset:0;
    backface-visibility:hidden;
    border-radius:12px;
    overflow:hidden;
  }

  /* FRONT visible by default */
  .front{ background:#fff; }

  /* BACK side visible when flipped */
  .back{
    background:#fff;
    transform:rotateY(180deg);
  }

  .tofrom{
    position:absolute;
    top:16px;
    left:16px;
    font-size:18px;
    line-height:1.25;
    font-weight:700;
    color:#1f1f1f;
  }

  /* Stamp layout: not overlapping */
  .stamp-area{
    position:absolute;
    top:10px;
    right:10px;
    width:132px;
    height:210px;
    display:flex;
    flex-direction:column;
    align-items:flex-end;
    gap:10px;
  }

  .forever-stamp{
    width:118px;
    height:148px;
    filter:drop-shadow(0 10px 16px rgba(0,0,0,.18));
    transform:none; /* straight */
  }

  .delivery-stamp{
    width:132px;
    height:auto;
    filter:drop-shadow(0 10px 16px rgba(0,0,0,.12));
    transform:rotate(-8deg);
    pointer-events:none;
  }

  /* Flap on FRONT */
  .flap{
    position:absolute;
    left:0; right:0;
    top:0;
    margin:auto;
    width:0;height:0;
    border-left:170px solid transparent;
    border-right:170px solid transparent;
    border-top:120px solid var(--accent);
    transform-origin:top;
    cursor:pointer;
    transition:transform .6s cubic-bezier(.2,.9,.2,1);
    z-index:2;
  }
  .flap.opened{ transform:rotateX(160deg); }

  .front::after{
    content:"";
    position:absolute;
    inset:0;
    border-radius:12px;
    border:2px solid rgba(0,0,0,.06);
    pointer-events:none;
  }

  /* ---------- OVERLAYS / LETTERS ---------- */
  .overlay{
    position:fixed;
    inset:0;
    display:none;
    place-items:center;
    padding:22px;                 /* shows background border */
    background:rgba(0,0,0,.16);   /* soft dim */
  }
  .overlay.show{
    display:grid;
    animation:fadeIn .2s ease both;
  }
  @keyframes fadeIn{ from{opacity:0;} to{opacity:1;} }

  .card{
    width:min(92vw, var(--cardMax));
    max-height:82vh;              /* won't grow past viewport */
    overflow:auto;                /* photos can be tall; card scrolls */
    background:#fff;
    border-radius:18px;
    box-shadow:0 22px 55px rgba(0,0,0,.24);
    padding:16px 16px 22px;
    min-height:var(--cardMinH);
    animation:cardIn .28s ease both;
    position:relative;
  }
  @keyframes cardIn{
    from{ transform:translateY(10px) scale(.985); opacity:0; }
    to{ transform:translateY(0) scale(1); opacity:1; }
  }
  .card.switchOut{ animation:cardOut .22s ease both; }
  @keyframes cardOut{ to{ transform:translateY(-6px) scale(.985); opacity:0; } }

  .card-header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    padding-bottom:8px;
    border-bottom:1px solid rgba(0,0,0,.08);
    margin-bottom:12px;
  }
  .card-title{ font-weight:800; font-size:18px; }

  .close{
    width:42px;height:42px;
    border-radius:14px;
    border:none;
    cursor:pointer;
    font-size:20px;
    background:rgba(0,0,0,.06);
    transition:transform .15s ease, background .15s ease;
  }
  .close:hover{ background:rgba(0,0,0,.10); transform:translateY(-1px); }
  .close:active{ transform:scale(.98); }

  /* Photos: full height (no forced cropping). Card scroll handles it. */
  .photo{
    width:100%;
    height:auto;
    display:block;
    border-radius:14px;
    margin:10px 0 14px;
  }

  .type{
    font-size:22px;
    font-weight:800;
    border-right:3px solid rgba(255,77,109,.55);
    overflow:hidden;
    white-space:nowrap;
    width:0;
    animation:typing 2.2s steps(34,end) forwards;
  }
  @keyframes typing{ to{ width:100%; } }

  /* We DO NOT increase height. NO will move absolutely within the card. */
  .btn-row{
    margin-top:18px;
    display:flex;
    gap:12px;
    flex-wrap:wrap;
    align-items:center;
    position:relative; /* anchor for initial layout only */
  }

  .pill{
    font-family:'Quicksand', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    font-size:18px;
    font-weight:800;
    padding:12px 22px;
    border:none;
    border-radius:999px;
    cursor:pointer;
    letter-spacing:.3px;
    text-transform:lowercase;
    transition:transform .15s ease, filter .15s ease, box-shadow .15s ease;
    box-shadow:0 12px 24px rgba(0,0,0,.12);
    will-change:transform, left, top;
    position:relative;
    z-index:3;
  }
  .pill:hover{
    transform:translateY(-2px);
    filter:brightness(1.02);
    box-shadow:0 16px 30px rgba(0,0,0,.16);
  }
  .pill:active{ transform:translateY(0px) scale(.98); }

  .yes{ background:var(--accent); color:#fff; }
  .no{ background:#2f2f2f; color:#fff; }

  .yes.boop{ animation:yesBoop 2.2s ease-in-out infinite; }
  @keyframes yesBoop{
    0%, 82%, 100% { transform:translateY(0); }
    86% { transform:translateY(-5px); }
    90% { transform:translateY(0); }
    94% { transform:translateY(-3px); }
    98% { transform:translateY(0); }
  }

  .response-text{
    font-size:18px;
    line-height:1.5;
    font-weight:700;
  }

  /* Floating hearts */
  .heart{
    position:fixed;
    bottom:-20px;
    font-size:26px;
    animation:float 7.5s linear;
    pointer-events:none;
  }
  @keyframes float{ to{ transform:translateY(-110vh); opacity:0;} }
</style>
</head>

<body>

<!-- Piano-only-ish (public CDN). If a host blocks, swap URL. -->
<audio id="music" preload="auto" loop crossorigin="anonymous">
  <!-- Pixabay hosts many piano tracks; this URL is an example and may vary by environment. -->
  <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_2b9c3d0b3e.mp3" type="audio/mpeg">
  <!-- fallback -->
  <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
</audio>

<div class="mailbox" id="mailbox" aria-label="Mailbox">
  <div class="flag-pole"></div>
  <div class="flag-triangle"></div>
  <div class="mail-slot"></div>
</div>

<div class="envelope" id="envelope" aria-label="Envelope">

  <!-- FRONT -->
  <div class="face front">
    <div class="flap" id="flap" title="Open"></div>
  </div>

  <!-- BACK -->
  <div class="face back">
    <div class="tofrom">
      To Aaron üíò<br>
      From Rizza üéÄ
    </div>

    <div class="stamp-area">
      <!-- forever stamp -->
      <svg class="forever-stamp" viewBox="0 0 220 280" xmlns="http://www.w3.org/2000/svg" aria-label="Forever stamp">
        <defs>
          <filter id="soft2" x="-20%" y="-20%" width="140%" height="140%">
            <feDropShadow dx="0" dy="0" stdDeviation="2" flood-color="rgba(0,0,0,.15)"/>
          </filter>
          <linearGradient id="bg" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0" stop-color="#ff3b72"/>
            <stop offset="1" stop-color="#b0192b"/>
          </linearGradient>
        </defs>

        <rect x="12" y="12" width="196" height="256" rx="12" fill="url(#bg)" filter="url(#soft2)"/>
        <rect x="16" y="16" width="188" height="248" rx="10"
              fill="none" stroke="#ffffff" stroke-opacity=".55"
              stroke-width="6" stroke-dasharray="2 12"/>

        <text x="28" y="55" fill="#ffffff" font-size="24" font-weight="800" font-family="Quicksand, Arial, sans-serif">
          us forever
        </text>

        <g transform="translate(28,78)">
          <path d="M72 60
                   C72 40, 96 40, 96 60
                   C96 78, 72 92, 72 92
                   C72 92, 48 78, 48 60
                   C48 40, 72 40, 72 60 Z"
                fill="#fff" opacity=".95"/>

          <path d="M10 128 L150 30" stroke="#ffd1dc" stroke-width="8" stroke-linecap="round"/>
          <path d="M150 30 L144 48 L166 40 Z" fill="#ffd1dc"/>
          <path d="M10 128 L28 120 L20 142 Z" fill="#ffd1dc"/>

          <g transform="translate(86,112)">
            <rect x="0" y="0" width="86" height="58" rx="10" fill="#ffb6c7"/>
            <path d="M0 8 L43 34 L86 8" fill="none" stroke="#fff" stroke-width="4" stroke-linecap="round"/>
            <path d="M40 40
                     C40 34, 48 34, 48 40
                     C48 46, 44 49, 44 49
                     C44 49, 40 46, 40 40 Z"
                  fill="#ff3b5c"/>
          </g>

          <circle cx="18" cy="22" r="4" fill="#fff" opacity=".85"/>
          <circle cx="132" cy="92" r="3" fill="#fff" opacity=".75"/>
          <circle cx="40" cy="98" r="2.5" fill="#fff" opacity=".7"/>
        </g>

        <text x="152" y="250" fill="#ffffff" font-size="20" font-weight="700" font-family="Quicksand, Arial, sans-serif">
          forever
        </text>
      </svg>

      <!-- delivery stamp (dark red) -->
      <svg class="delivery-stamp" viewBox="0 0 520 300" xmlns="http://www.w3.org/2000/svg" aria-label="Special delivery stamp">
        <defs>
          <pattern id="dots2" width="14" height="14" patternUnits="userSpaceOnUse">
            <circle cx="7" cy="7" r="2.1" fill="var(--deliveryRed)" opacity=".9"/>
          </pattern>
        </defs>

        <rect x="12" y="12" width="496" height="276" rx="16"
              fill="none" stroke="var(--deliveryRed)" stroke-width="10" opacity=".92" />
        <rect x="26" y="26" width="468" height="248" rx="12"
              fill="none" stroke="url(#dots2)" stroke-width="10" opacity=".92" />

        <g fill="var(--deliveryRed)" opacity=".9">
          <path d="M260 56 l10 20 22 3-16 15 4 22-20-11-20 11 4-22-16-15 22-3z"/>
        </g>

        <text x="260" y="112" text-anchor="middle"
              fill="var(--deliveryRed)" font-size="54"
              font-weight="800" font-family="Quicksand, Arial, sans-serif"
              letter-spacing="2" opacity=".92">
          SPECIAL DELIVERY
        </text>

        <g stroke="var(--deliveryRed)" stroke-width="6" opacity=".9" fill="none">
          <path d="M80 150 C130 130, 180 170, 230 150 S330 170, 380 150 S460 170, 500 150"/>
          <path d="M80 172 C130 152, 180 192, 230 172 S330 192, 380 172 S460 192, 500 172"/>
          <path d="M80 194 C130 174, 180 214, 230 194 S330 214, 380 194 S460 214, 500 194"/>
        </g>

        <rect x="58" y="214" width="404" height="64" rx="12"
              fill="none" stroke="var(--deliveryRed)" stroke-width="8" opacity=".92"/>

        <text x="260" y="244" text-anchor="middle"
              fill="var(--deliveryRed)" font-size="22"
              font-weight="800" font-family="Quicksand, Arial, sans-serif"
              letter-spacing="1" opacity=".95">
          CUPID POST OFFICE
        </text>

        <text x="260" y="268" text-anchor="middle"
              fill="var(--deliveryRed)" font-size="18"
              font-weight="800" font-family="Quicksand, Arial, sans-serif"
              opacity=".95">
          <tspan id="deliveryDate"></tspan>
        </text>
      </svg>
    </div>
  </div>
</div>

<!-- FIRST LETTER -->
<div class="overlay" id="overlayLetter">
  <div class="card" id="letterCard" role="dialog" aria-modal="true">
    <div class="card-header">
      <div class="card-title">Special Note</div>
      <button class="close" id="closeLetterBtn" aria-label="Close">‚úï</button>
    </div>

    <img src="photo.jpeg" class="photo" alt="Photo 1">

    <div class="type">Will you be my Valentine?</div>

    <div class="btn-row">
      <button class="pill yes boop" id="yesBtn">yes</button>
      <button class="pill no" id="noBtn">no</button>
    </div>
  </div>
</div>

<!-- RESPONSE LETTER -->
<div class="overlay" id="overlayResponse">
  <div class="card" id="responseCard" role="dialog" aria-modal="true">
    <div class="card-header">
      <div class="card-title">Message</div>
      <button class="close" id="closeResponseBtn" aria-label="Close">‚úï</button>
    </div>

    <img src="photo2.jpeg" class="photo" alt="Photo 2">

    <div class="response-text">
      I love you ‚ô•Ô∏è Thank you for being my valentine.<br><br>
      I cant wait for our hiking date this weekend.<br><br>
      PS. I wouldn‚Äôt have taken no for an answer.
    </div>
  </div>
</div>

<script>
  const mailbox = document.getElementById("mailbox");
  const envelope = document.getElementById("envelope");
  const flap = document.getElementById("flap");

  const overlayLetter = document.getElementById("overlayLetter");
  const letterCard = document.getElementById("letterCard");
  const closeLetterBtn = document.getElementById("closeLetterBtn");

  const overlayResponse = document.getElementById("overlayResponse");
  const responseCard = document.getElementById("responseCard");
  const closeResponseBtn = document.getElementById("closeResponseBtn");

  const yesBtn = document.getElementById("yesBtn");
  const noBtn = document.getElementById("noBtn");
  const music = document.getElementById("music");

  // NO: move 3 times, 4th flies away
  const NO_MOVE_LIMIT = 3;
  let noClicks = 0;

  let heartsInterval = null;

  // date
  const today = new Date();
  document.getElementById("deliveryDate").textContent =
    today.toLocaleDateString(undefined, { year:"numeric", month:"long", day:"numeric" });

  /* Audio unlock ‚Äî required on iOS/Chrome mobile */
  let unlocked = false;
  function unlockAudio(){
    if (unlocked) return;
    unlocked = true;
    try{
      music.muted = true;
      music.volume = 0;
      const p = music.play();
      if (p && typeof p.then === "function"){
        p.then(() => {
          music.pause();
          music.currentTime = 0;
          music.muted = false;
          music.volume = 0.35;
        }).catch(() => {
          music.muted = false;
          music.volume = 0.35;
        });
      } else {
        music.muted = false;
        music.volume = 0.35;
      }
    }catch(e){
      music.muted = false;
      music.volume = 0.35;
    }
  }
  window.addEventListener("pointerdown", unlockAudio, { once:true });

  /* Mailbox -> Envelope */
  mailbox.addEventListener("click", () => {
    mailbox.classList.add("opening");
    setTimeout(() => {
      mailbox.style.display = "none";
      envelope.style.display = "block";
      envelope.classList.remove("flip"); // start on FRONT
    }, 260);
  });

  /* Flip envelope (click outside flap) */
  envelope.addEventListener("click", (e) => {
    if (e.target === flap) return;
    envelope.classList.toggle("flip");
  });

  /* Open letter */
  flap.addEventListener("click", (e) => {
    e.stopPropagation();
    flap.classList.add("opened");
    setTimeout(() => openLetter(), 220);
  });

  function openLetter(){
    overlayLetter.classList.add("show");
    resetNoButton();
  }
  function closeLetter(){
    overlayLetter.classList.remove("show");
    flap.classList.remove("opened");
  }
  function openResponse(){
    overlayResponse.classList.add("show");
  }
  function closeResponse(){
    overlayResponse.classList.remove("show");
    stopHearts();
    try{ music.pause(); }catch(e){}
  }

  closeLetterBtn.addEventListener("click", closeLetter);
  closeResponseBtn.addEventListener("click", closeResponse);

  overlayLetter.addEventListener("click", closeLetter);
  letterCard.addEventListener("click", (e) => e.stopPropagation());

  overlayResponse.addEventListener("click", closeResponse);
  responseCard.addEventListener("click", (e) => e.stopPropagation());

  /* YES: switch + music + hearts */
  yesBtn.addEventListener("click", () => {
    closeLetter();
    openResponse();

    // play on gesture
    try{
      music.currentTime = 0;
      music.volume = 0.35;
      music.play();
    }catch(e){}

    startHearts();
    navigator.vibrate?.(120);
  });

  /* NO: teleport anywhere INSIDE the letterCard (even above image), without changing height */
  noBtn.addEventListener("click", () => {
    noClicks++;

    // shrink each click
    const scale = Math.max(0.55, 1 - (noClicks * 0.16));
    noBtn.style.transform = `scale(${scale})`;

    if (noClicks <= NO_MOVE_LIMIT){
      // Make NO absolute relative to the card so it can move over the whole letter
      const cardRect = letterCard.getBoundingClientRect();
      const btnRect = noBtn.getBoundingClientRect();

      const pad = 14;
      const maxX = Math.max(0, cardRect.width  - btnRect.width  - pad*2);
      const maxY = Math.max(0, cardRect.height - btnRect.height - pad*2);

      // Random anywhere in the card (covers image area too)
      const x = Math.random() * maxX + pad;
      const y = Math.random() * maxY + pad;

      noBtn.style.position = "absolute";
      noBtn.style.left = x + "px";
      noBtn.style.top  = y + "px";
      noBtn.style.zIndex = "10";
    } else {
      noBtn.disabled = true;
      noBtn.style.transition = "transform .8s ease, opacity .8s ease";
      noBtn.style.transform = `translateY(-500px) rotate(-18deg) scale(${scale})`;
      noBtn.style.opacity = "0";
      setTimeout(() => noBtn.style.display = "none", 850);
    }
  });

  function resetNoButton(){
    noClicks = 0;
    noBtn.style.display = "inline-block";
    noBtn.disabled = false;
    noBtn.style.transition = "";
    noBtn.style.opacity = "1";
    noBtn.style.position = "relative";
    noBtn.style.left = "0px";
    noBtn.style.top  = "0px";
    noBtn.style.transform = "scale(1)";
    noBtn.style.zIndex = "3";
  }

  /* hearts */
  function startHearts(){
    if (heartsInterval) return;
    heartsInterval = setInterval(() => {
      const h = document.createElement("div");
      h.className = "heart";
      h.innerText = ["üíñ","üíó","üíû","üéÄ","‚ú®","üå∏"][Math.floor(Math.random()*6)];
      h.style.left = Math.random() * 100 + "vw";
      document.body.appendChild(h);
      setTimeout(() => h.remove(), 7500);
    }, 700);
  }
  function stopHearts(){
    if (!heartsInterval) return;
    clearInterval(heartsInterval);
    heartsInterval = null;
  }
</script>

</body>
</html>